<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trader Route ‚Äì Create Request</title>
  <meta name="description" content="Create a free trade request on Trader Route and connect with importers and exporters worldwide.">
  <link rel="icon" href="assets/logos.png" />

  <!-- Google Analytics 4 | Trader Route -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YVEKRWM5VB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-YVEKRWM5VB', {
    'anonymize_ip': true,        // IP gizliliƒüi
    'send_page_view': true,      // Sayfa g√∂r√ºnt√ºlemelerini g√∂nder
    'cookie_flags': 'SameSite=None;Secure' // G√ºvenli √ßerezler
  });
</script>
  
  <style>
    body{font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif;margin:0;background:#f6f8fa;}
    header{display:flex;align-items:center;justify-content:space-between;background:#fff;padding:10px 40px;
           box-shadow:0 2px 8px rgba(0,0,0,.1);position:sticky;top:0;z-index:1000;}
    .logo-container{display:flex;align-items:center;gap:10px;cursor:pointer;}
    .logo-container img{height:45px;}
    .logo-text{font-size:15px;color:#555;font-weight:500;}
    form{max-width:600px;margin:40px auto;background:#fff;padding:30px;border-radius:10px;
         box-shadow:0 2px 10px rgba(0,0,0,.05);}
    h2{text-align:center;color:#008b6a;margin-bottom:25px;}
    label{display:block;font-weight:600;margin-top:10px;margin-bottom:6px;}
    input,textarea,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;font-size:14px;}
    textarea{resize:vertical;min-height:90px;}
    .radio-group{display:flex;gap:15px;margin-top:10px;}
    button{background:#008b6a;color:#fff;border:none;padding:12px 18px;border-radius:6px;
           cursor:pointer;font-weight:600;margin-top:20px;width:100%;transition:.3s;}
    button:hover{background:#006b52;}
    .success-msg{display:none;color:#008b6a;text-align:center;margin-top:15px;font-weight:600;}

    .type-section{text-align:center;margin:20px 0;}
    .type-section label{font-weight:600;font-size:15px;color:#222;}
    .type-options{display:flex;justify-content:center;gap:15px;margin-top:10px;}
    .type-options input[type="radio"]{display:none;}
    .type-options .type-btn{background:#f4f4f4;color:#333;border:2px solid #008b6a;border-radius:25px;
                            padding:10px 25px;font-weight:600;cursor:pointer;transition:0.25s;}
    .type-options input[type="radio"]:checked + .type-btn{
      background:#008b6a;color:#fff;box-shadow:0 0 8px rgba(0,139,106,0.4);}
    .type-options .type-btn:hover{background:#e9f8f4;}
  </style>
</head>

<body>
  <!-- ‚úÖ HEADER -->
  <header>
    <div class="logo-container" onclick="location.href='index.html'">
      <img src="assets/logos.png" alt="Trader Route Logo">
      <span class="logo-text">The Silk Road of E-Commerce</span>
    </div>
  </header>

  <form id="requestForm">
    <h2>Create Trade Request</h2>

    <label for="title">Request Title</label>
    <input type="text" id="title" placeholder="Example: I want to buy banana" required>

    <label for="description">Description</label>
    <textarea id="description" placeholder="Describe your request..." minlength="10" required></textarea>

    <label for="category">Category</label>
    <select id="category" required>
      <option value="">Select Category</option>
    </select>

    <label for="country">Country</label>
    <select id="country" required>
      <option value="">Select Country</option>
    </select>

    <div class="type-section">
      <label>Request Type</label>
      <div class="type-options">
        <input type="radio" id="buy" name="type" value="buy">
        <label for="buy" class="type-btn">Buy Request</label>

        <input type="radio" id="sell" name="type" value="sell">
        <label for="sell" class="type-btn">Sell Offer</label>
      </div>
      <!-- üì∏ Image Upload Section -->
<div class="form-group">
  <label for="imageUpload">Add up to 3 images:</label>
  <input type="file" id="imageUpload" multiple accept="image/*" style="display:block;margin-top:5px;">
  <div id="imagePreview" style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;"></div>
</div>
      
    </div>
<input type="hidden" name="imageUrl">
    <button type="submit">Submit Request</button>
    <div class="success-msg" id="successMsg">Your request has been created successfully!</div>
  </form>

  <!-- ‚úÖ YENƒ∞ / D√úZENLEME Sƒ∞STEMƒ∞ -->
  <script>
  const form = document.getElementById("requestForm");
  const successMsg = document.getElementById("successMsg");

  form.addEventListener("submit", function(e){
    e.preventDefault();

    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();
    const category = document.getElementById("category").value;
    const country = document.getElementById("country").value;
    const type = document.querySelector('input[name="type"]:checked')?.value;

    const currentUser = JSON.parse(localStorage.getItem("tr_user") || "null");
    const requests = JSON.parse(localStorage.getItem("requests") || "[]");

    const editId = new URLSearchParams(window.location.search).get("edit");
    if(editId){
      const idx = requests.findIndex(r => r.id == editId);
      if(idx !== -1){
        requests[idx].title = title;
        requests[idx].description = description;
        requests[idx].category = category;
        requests[idx].country = country;
        requests[idx].type = type;
        requests[idx].edited = true;
        localStorage.setItem("requests", JSON.stringify(requests));
        alert("‚úÖ Request updated successfully!");
        localStorage.removeItem("edit_request");
        location.href = "profile.html";
        return;
      }
    }

    // Yeni ilan ekle
    const newRequest = {
      id: Date.now(),
      title,
      description,
      category,
      country,
      type,
      user: currentUser?.email || "Guest",
      date: new Date().toISOString(),
      approved: false,
images: uploadedImageUrls, // eklenen resimlerin URL‚Äôleri
      imageUrl: uploadedImageUrls.length > 0 ? uploadedImageUrls[0] : "",
    };

  requests.push(newRequest);
localStorage.setItem("requests", JSON.stringify(requests));
saveRequestToServer(newRequest);

successMsg.style.display = "block";
form.reset();
setTimeout(()=>{
  successMsg.style.display = "none";
  location.href = "requests.html";
},1500);

    // üåç Sunucuya kaydetme (Requests.json g√ºncelleme)

// üåç Cloudflare Worker √ºzerinden g√ºvenli kayƒ±t (JSONBin baƒülantƒ±lƒ±)
async function saveRequestToServer(newRequest) {
  try {
    const response = await fetch("https://divine-hill-9557.traderroutee.workers.dev/requests", {

      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(newRequest)
    });

    if (response.ok) {
      console.log("‚úÖ Request saved successfully on server!");
    } else {
      console.error("‚ùå Server save failed:", await response.text());
    }
  } catch (err) {
    console.error("‚ö†Ô∏è Connection error:", err);
  }
}

  });
  </script>

  <!-- ‚úÖ KATEGORƒ∞ & √úLKE Y√úKLEME -->
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const categorySelect = document.getElementById("category");
    const countrySelect = document.getElementById("country");

    const categories = [
      "Agriculture","Apparel & Fashion","Automobiles & Motorcycles","Beauty & Personal Care",
      "Business Services","Chemicals","Computer Hardware & Software","Construction & Real Estate",
      "Consumer Electronics","Electrical Equipment & Supplies","Energy","Environment","Food & Beverage",
      "Furniture","Gifts & Crafts","Hardware","Health & Medical","Home & Garden","Industrial Machinery",
      "Jewelry & Watches","Lights & Lighting","Luggage, Bags & Cases","Mechanical Parts & Fabrication",
      "Minerals & Metallurgy","Office Supplies","Packaging & Printing","Security & Protection",
      "Service Equipment","Sports & Entertainment","Telecommunications","Textiles & Leather Products",
      "Tools","Toys & Hobbies","Transportation","Travel & Tourism","Others"
    ];

    const countries = [
      "Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria",
      "Azerbaijan","Bahamas","Bahrain","Bangladesh","Belgium","Brazil","Bulgaria","Cambodia","Cameroon",
      "Canada","Chile","China","Colombia","Croatia","Cuba","Cyprus","Czech Republic","Denmark","Ecuador",
      "Egypt","Estonia","Finland","France","Germany","Greece","Hong Kong","Hungary","Iceland","India",
      "Indonesia","Iran","Iraq","Ireland","Israel","Italy","Japan","Jordan","Kazakhstan","Kenya",
      "Korea, South","Kuwait","Latvia","Lebanon","Lithuania","Luxembourg","Malaysia","Mexico","Moldova",
      "Monaco","Mongolia","Morocco","Netherlands","New Zealand","Nigeria","Norway","Oman","Pakistan",
      "Philippines","Poland","Portugal","Qatar","Romania","Russia","Saudi Arabia","Serbia","Singapore",
      "Slovakia","Slovenia","South Africa","Spain","Sri Lanka","Sweden","Switzerland","Syria","Taiwan",
      "Thailand","Tunisia","Turkey","Ukraine","United Arab Emirates","United Kingdom","United States","Vietnam","Zambia","Zimbabwe"
    ];

    categories.forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat;
      categorySelect.appendChild(opt);
    });

    countries.forEach(cty => {
      const opt = document.createElement("option");
      opt.value = cty;
      opt.textContent = cty;
      countrySelect.appendChild(opt);
    });

    // Eƒüer edit mode varsa, bilgileri y√ºkle
    const editId = new URLSearchParams(window.location.search).get("edit");
    if(editId){
      const editData = JSON.parse(localStorage.getItem("edit_request") || "null");
      if(editData){
        document.getElementById("title").value = editData.title || "";
        document.getElementById("description").value = editData.description || "";
        document.getElementById("category").value = editData.category || "";
        document.getElementById("country").value = editData.country || "";
        if(editData.type === "buy") document.getElementById("buy").checked = true;
        else if(editData.type === "sell") document.getElementById("sell").checked = true;
        const header = document.querySelector("h2");
        if(header) header.textContent = "Edit Trade Request";
      }
    }
  });

    <script>
async function saveRequestToServer(newRequest) {
  try {
    const response = await fetch("https://divine-hill-9557.traderroutee.workers.dev/requests", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newRequest)
    });
    if (response.ok) {
      console.log("‚úÖ Request saved successfully on server!");
    } else {
      console.error("‚ùå Server save failed:", await response.text());
    }
  } catch (err) {
    console.error("‚ö†Ô∏è Connection error:", err);
  }
}
</script>

  <script>
// === Image Upload Preview & Cloudflare Upload ===
const imageInput = document.getElementById("imageUpload");
const preview = document.getElementById("imagePreview");
let uploadedImageUrls = [];

imageInput?.addEventListener("change", async (e) => {
  const files = Array.from(e.target.files).slice(0, 3); // max 3 image
  preview.innerHTML = "";
  uploadedImageUrls = [];

  for (const file of files) {
    // √ñnizleme
    const reader = new FileReader();
    reader.onload = ev => {
      const img = document.createElement("img");
      img.src = ev.target.result;
      img.style.width = "80px";
      img.style.height = "80px";
      img.style.objectFit = "cover";
      img.style.border = "1px solid #ccc";
      img.style.borderRadius = "6px";
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);

    // Cloudflare Worker'a y√ºkleme
    const formData = new FormData();
    formData.append("file", file);
    try {
      const res = await fetch("https://divine-hill-9557.traderroutee.workers.dev/upload", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.url) uploadedImageUrls.push(data.url);
    } catch (err) {
      console.error("Upload failed:", err);
    }
  }
});
</script>

  
  
</body>
</html>
