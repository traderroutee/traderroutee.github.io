<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Profile ‚Äî Trader Route</title>
  <meta name="description" content="View and manage your Trader Route account profile, messages, and listings.">
  <meta name="author" content="Trader Route">
  <link rel="icon" href="assets/logos.png" type="image/png" />

  <style>
    :root{--green:#008b6a;--dark:#006b52;--bg:#f6f8fa;}
    body{margin:0;font-family:"Inter","Segoe UI",sans-serif;background:var(--bg);color:#222;}
    header{display:flex;align-items:center;justify-content:space-between;background:#fff;
           padding:10px 40px;box-shadow:0 2px 8px rgba(0,0,0,.1);position:sticky;top:0;z-index:1000;}
    .logo-container{display:flex;align-items:center;gap:10px;cursor:pointer;}
    .logo-container img{height:45px;}
    .logo-text{font-size:15px;color:#555;font-weight:500;}
    nav{display:flex;align-items:center;gap:20px;}
    nav a{text-decoration:none;color:#000;font-weight:500;}
    nav a:hover{color:var(--green);}
    .container{max-width:950px;margin:50px auto;padding:20px;}
    h2{text-align:center;color:var(--green);margin-bottom:25px;}

    /* === Profile Card === */
    .profile-card{background:#fff;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,0.06);
                  padding:30px;max-width:750px;margin:0 auto 25px;text-align:center;}
    .profile-avatar{width:90px;height:90px;border-radius:50%;object-fit:cover;
                    box-shadow:0 2px 6px rgba(0,0,0,0.15);}
    .profile-name{font-size:22px;font-weight:700;margin:15px 0 8px;}
    .profile-email{color:#666;font-size:15px;margin-bottom:20px;}
    .info-grid{display:flex;justify-content:center;flex-wrap:wrap;gap:15px;}
    .info-box{background:#f8fdfc;border:1px solid #e1f3ee;padding:15px 20px;border-radius:10px;
              min-width:200px;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,0.05);}
    .info-box h4{margin:0 0 6px;font-size:15px;color:#007b63;}
    .info-box p{margin:0;font-size:14px;font-weight:600;color:#111;}
    .logout-btn{background:#d9534f;color:#fff;border:none;padding:10px 20px;border-radius:8px;
                font-weight:600;margin-top:25px;cursor:pointer;transition:.25s;}
    .logout-btn:hover{background:#c9302c;}

    /* === Inbox === */
    .inbox-section{background:#fff;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,0.06);
                   padding:25px;max-width:750px;margin:0 auto 25px;}
    .inbox-section h3{text-align:center;margin-top:0;color:#007b63;}
    .message-item{border:1px solid #e5e7eb;border-radius:8px;padding:12px 15px;margin-bottom:10px;
                  background:#f9fdfc;}
    .message-item strong{color:#008b6a;}
    .message-item p{margin:8px 0;font-size:14px;}
    .reply-btn{background:#008b6a;color:#fff;border:none;padding:6px 12px;border-radius:6px;
               cursor:pointer;font-size:13px;font-weight:600;transition:.2s;}
    .reply-btn:hover{background:#006b52;}
    .no-messages{text-align:center;color:#777;font-size:14px;margin-top:10px;}

    /* === Listings === */
    .listings-section{background:#fff;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,0.06);
                      padding:25px;max-width:750px;margin:0 auto;}
    .listings-section h3{text-align:center;color:#007b63;margin-top:0;}
    .listing-item{border:1px solid #e5e7eb;border-radius:8px;padding:15px;margin-bottom:10px;background:#f9fdfc;}
    .listing-item h4{margin:0 0 8px;color:#008b6a;}
    .listing-item p{margin:4px 0;font-size:14px;}
    .listing-actions{margin-top:10px;}
    .edit-btn,.delete-btn{border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;margin-right:5px;}
    .edit-btn{background:#007bff;color:#fff;}
    .edit-btn:hover{background:#0056b3;}
    .delete-btn{background:#d9534f;color:#fff;}
    .delete-btn:hover{background:#c9302c;}
    .no-listings{text-align:center;color:#777;font-size:14px;margin-top:10px;}

    /* === Modal === */
    .modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.4);}
    .modal-content{background:#fff;margin:10% auto;padding:20px;border-radius:10px;max-width:500px;box-shadow:0 4px 12px rgba(0,0,0,0.3);}
    .modal-content h4{margin-top:0;color:#008b6a;}
    .modal-content input,.modal-content textarea,.modal-content select{
      width:100%;padding:8px;margin:6px 0 10px;border:1px solid #ccc;border-radius:6px;font-size:14px;
    }
    .modal-content button{background:#008b6a;color:#fff;border:none;padding:8px 15px;border-radius:6px;cursor:pointer;font-weight:600;}
    .modal-content button:hover{background:#006b52;}
  </style>
</head>

<body>

  <header>
  <div class="logo-container" onclick="location.href='index.html'">
    <img src="assets/logos.png" alt="Trader Route Logo">
    <span class="logo-text">The Silk Road of E-Commerce</span>
  </div>

  <nav>
    <a href="index.html">Home</a>
    <a href="companies.html">Companies</a>
    <a href="requests.html">Requests</a>
    <a href="contact.html">Contact</a>
    <a href="pricing.html">Pricing</a>
  </nav>

  <!-- üì© Messages Button -->
  <div id="messageIconContainer" style="position:relative;margin-right:25px;">
    <a href="messages.html" id="messageIconLink" style="text-decoration:none;color:inherit;">
      <img src="assets/email.png" alt="Messages" style="width:25px;height:25px;cursor:pointer;">
      <span id="messageBadge"
            style="position:absolute;top:-5px;right:-8px;
            background:red;color:white;font-size:11px;
            border-radius:50%;padding:2px 5px;display:none;">
      </span>
    </a>
  </div>
</header>
  
  <div class="container">
    <h2>My Profile</h2>

    <div class="profile-card" id="profileCard">
      <img src="assets/user-icon.png" alt="User" class="profile-avatar">
      <div class="profile-name" id="profileName">-</div>
      <div class="profile-email" id="profileEmail">-</div>

      <div class="info-grid">
        <div class="info-box">
          <h4>Country</h4>
          <p id="profileCountry">-</p>
        </div>
        <div class="info-box">
          <h4>Business Category</h4>
          <p id="profileCategory">-</p>
        </div>
      </div>

      <button class="logout-btn" onclick="logoutUser()">Logout</button>
    </div>

    <!-- üí¨ Inbox -->
    <div class="inbox-section">
      <h3>üì® Inbox</h3>
      <div id="inboxMessages"></div>
    </div>

    <!-- üìã My Listings -->
    <div class="listings-section">
      <h3>üìã My Listings</h3>
      <div id="myListings"></div>
    </div>
  </div>

  <!-- ‚úÖ USER REQUESTS MANAGEMENT SECTION -->
<section class="user-requests" style="margin-top:40px;">
  <h2>My Trade Requests</h2>
  <table style="width:100%;border-collapse:collapse;margin-top:10px;">
    <thead>
      <tr style="background:#f1f1f1;">
        <th style="padding:10px;text-align:left;">Title</th>
        <th style="padding:10px;text-align:left;">Category</th>
        <th style="padding:10px;text-align:left;">Country</th>
        <th style="padding:10px;text-align:left;">Status</th>
        <th style="padding:10px;text-align:left;">Actions</th>
      </tr>
    </thead>
    <tbody id="userRequestsTable">
      <tr><td colspan="5" style="text-align:center;color:#888;padding:15px;">Loading your requests...</td></tr>
    </tbody>
  </table>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const currentUser = JSON.parse(localStorage.getItem("tr_user") || "null");
  const table = document.getElementById("userRequestsTable");

  if(!currentUser){
    table.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#888;padding:15px;">
      Please log in to view your requests.</td></tr>`;
    return;
  }

  const all = JSON.parse(localStorage.getItem("requests") || "[]");
  const myReqs = all.filter(r => r.user === currentUser.email);

  if(myReqs.length === 0){
    table.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#888;padding:15px;">
      You haven‚Äôt created any requests yet.</td></tr>`;
    return;
  }

  table.innerHTML = "";
  myReqs.reverse().forEach(req => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td style="padding:10px;">${req.title}</td>
      <td style="padding:10px;">${req.category}</td>
      <td style="padding:10px;">${req.country}</td>
      <td style="padding:10px;">${req.approved ? "‚úÖ Approved" : "‚è≥ Pending"}</td>
      <td style="padding:10px;">
        <button onclick="editRequest(${req.id})" style="background:#007bff;color:#fff;border:none;border-radius:5px;padding:5px 8px;margin-right:5px;">Edit</button>
        <button onclick="deleteMyRequest(${req.id})" style="background:#d9534f;color:#fff;border:none;border-radius:5px;padding:5px 8px;">Delete</button>
      </td>`;
    table.appendChild(tr);
  });
});

// ‚úèÔ∏è Edit Function
function editRequest(id){
  const all = JSON.parse(localStorage.getItem("requests") || "[]");
  const req = all.find(r => r.id === id);
  if(!req) return alert("Request not found.");
  localStorage.setItem("edit_request", JSON.stringify(req));
  window.location.href = "request-form.html?edit=" + id;
}

// üóëÔ∏è Delete Function
function deleteMyRequest(id){
  if(!confirm("Are you sure you want to delete this request?")) return;
  const all = JSON.parse(localStorage.getItem("requests") || "[]");
  const updated = all.filter(r => r.id !== id);
  localStorage.setItem("requests", JSON.stringify(updated));
  alert("Request deleted successfully!");
  location.reload();
}
</script>


  <!-- üß© Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h4>Edit Listing</h4>
      <input type="text" id="editTitle" placeholder="Title">
      <textarea id="editDesc" rows="3" placeholder="Description"></textarea>
      <input type="text" id="editCountry" placeholder="Country">
      <input type="text" id="editCategory" placeholder="Category">
      <select id="editType">
        <option value="buy">Buy</option>
        <option value="sell">Sell</option>
      </select>
      <button onclick="saveEdit()">Save Changes</button>
      <button onclick="closeModal()" style="background:#aaa;margin-left:8px;">Cancel</button>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("tr_user") || "null");
    if(!user){
      alert("You must log in first.");
      location.href = "login.html";
    } else {
      document.getElementById("profileName").textContent = user.name || "-";
      document.getElementById("profileEmail").textContent = user.email || "-";
      document.getElementById("profileCountry").textContent = user.country || "Not set";
      document.getElementById("profileCategory").textContent = user.category || "Not set";
    }

    // === Inbox ===
    function renderInbox(){
      const inboxDiv = document.getElementById("inboxMessages");
      inboxDiv.innerHTML = "";
      const all = JSON.parse(localStorage.getItem("messages") || "[]");
      const myMsgs = all.filter(m => m.to === user.email);
      if(myMsgs.length === 0){
        inboxDiv.innerHTML = '<div class="no-messages">No messages yet.</div>';
        return;
      }
      myMsgs.reverse().forEach(msg=>{
        const div=document.createElement("div");
        div.className="message-item";
        div.innerHTML=`
          <strong>From:</strong> ${msg.from}<br>
          <p>${msg.text}</p>
          <button class="reply-btn" onclick="replyTo('${msg.from}')">Reply</button>
        `;
        inboxDiv.appendChild(div);
      });
    }

    function replyTo(email){
      location.href = 'messages.html?to=' + encodeURIComponent(email);
    }

    // === My Listings ===
    let editId = null;
    function renderListings(){
      const listDiv=document.getElementById("myListings");
      const all=JSON.parse(localStorage.getItem("requests")||"[]");
      const my=all.filter(r=>r.user===user.email);
      listDiv.innerHTML="";
      if(my.length===0){listDiv.innerHTML='<div class="no-listings">No listings yet.</div>';return;}
      my.reverse().forEach(r=>{
        const div=document.createElement("div");
        div.className="listing-item";
        div.innerHTML=`
          <h4>${r.title}</h4>
          <p>${r.description}</p>
          <p><strong>${r.country}</strong> ‚Ä¢ ${r.category} ‚Ä¢ ${r.type}</p>
          <div class="listing-actions">
            <button class="edit-btn" onclick="openEdit(${r.id})">Edit</button>
            <button class="delete-btn" onclick="deleteListing(${r.id})">Delete</button>
          </div>`;
        listDiv.appendChild(div);
      });
    }

    function openEdit(id){
      const all=JSON.parse(localStorage.getItem("requests")||"[]");
      const r=all.find(x=>x.id==id);
      if(!r)return;
      editId=id;
      document.getElementById("editTitle").value=r.title;
      document.getElementById("editDesc").value=r.description;
      document.getElementById("editCountry").value=r.country;
      document.getElementById("editCategory").value=r.category;
      document.getElementById("editType").value=r.type;
      document.getElementById("editModal").style.display="block";
    }

    function saveEdit(){
      const all=JSON.parse(localStorage.getItem("requests")||"[]");
      const i=all.findIndex(x=>x.id==editId);
      if(i===-1)return;
      all[i].title=document.getElementById("editTitle").value;
      all[i].description=document.getElementById("editDesc").value;
      all[i].country=document.getElementById("editCountry").value;
      all[i].category=document.getElementById("editCategory").value;
      all[i].type=document.getElementById("editType").value;
      localStorage.setItem("requests",JSON.stringify(all));
      closeModal();
      renderListings();
      alert("Listing updated successfully!");
    }

    function deleteListing(id){
      if(!confirm("Are you sure you want to delete this listing?"))return;
      const all=JSON.parse(localStorage.getItem("requests")||"[]").filter(x=>x.id!=id);
      localStorage.setItem("requests",JSON.stringify(all));
      renderListings();
    }

    function closeModal(){document.getElementById("editModal").style.display="none";}

    function logoutUser(){
      localStorage.removeItem("tr_user");
      location.href = "index.html";
    }

    renderInbox();
    renderListings();
  </script>

  <script>
// === Mesaj bildirimi kontrol√º ===
(function(){
  const badge = document.getElementById("messageBadge");
  const user = JSON.parse(localStorage.getItem("tr_user") || "null");
  if(!user || !badge) return;

  const allMessages = JSON.parse(localStorage.getItem("tr_messages") || "[]");
  const unread = allMessages.filter(m => m.to === user.email && !m.read);

  if(unread.length > 0){
    badge.textContent = unread.length;
    badge.style.display = "inline-block";
  } else {
    badge.style.display = "none";
  }
})();
</script>
  
</body>
</html>
